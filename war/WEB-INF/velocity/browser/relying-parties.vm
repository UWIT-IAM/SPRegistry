#* ========================================================================
 * Copyright (c) 2009-2011 The University of Washington
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================================
 *#

##
## Templates for rp list   
##

#parse ( "crumbs.vm" )

<script>
v_sectionType = 'rps';

var sps = [];
var nsp = 0;

## load sp list into arrays
function spEnt(md, ent, desc) {
  this.metadataId = md;
  this.entityId = ent;
  this.description = desc;
}
spEnt.prototype.getMd = function() {
  return this.metadataId;
};
spEnt.prototype.getId = function() {
  return this.entityId;
};
spEnt.prototype.getDesc = function() {
  return this.description;
};
spEnt.prototype.contains = function(str) {
  if (this.entityId.toLowerCase().search(str.toLowerCase())>=0) return true;
  return false;
};


#foreach ($rp in $relyingParties )
 sps[nsp++] = new spEnt('$rp.metadataId', '$rp.entityId', '$!{rp.organization.OrganizationName}');
#end 


function doRpClick(i) {
  window.location = "$root$vers/rp?id=" + sps[i].getId() + "&mdid=" + sps[i].getMd();
}

function doLookup() {
   dns = document.getElementById('newDns').value.trim();
   window.location = "$root$vers/rp/rp?opt=lookup&dns=" + dns;
}

// fill out the list according to filter settings
function doFilter() {
  icsp = document.getElementById('selectic').checked;
  uwsp = document.getElementById('selectuw').checked;
  txsp = document.getElementById('selecttxt').value.trim();
  
  var htm = '<table cellpadding="0" cellspacing="2" border="0">';
  for (i=0; i<nsp; i++) {
    if ((!icsp) && (sps[i].getMd()=='IC')) continue;
    if ((!uwsp) && (sps[i].getMd()=='UW' || sps[i].getMd()=='UWfixed')) continue;
    if ((txsp.length>0) && !sps[i].contains(txsp)) continue;
    
    htm = htm + '<tr class="rpreference"><td class="rpmdid" align="left">' + sps[i].getMd().substring(0,2) + '</td>';
    htm = htm + '<td class="rpid" align="left">';
    htm = htm + '<a href="$root$vers/rp?id=' + sps[i].getId() + '&mdid=' + sps[i].getMd() + '" title="' + sps[i].getDesc() + '">' +
        sps[i].getId() + '</a>';
    htm = htm + '</td></tr>';
  }

 htm += '</table>';
 document.getElementById('splist').innerHTML = htm;
}

function localOnLoad() {
  doFilter();
}

</script>

#set ( $showNewCrumb = 1 )

##
## ----- Left side content -----
##

#pageStart

<table cellpadding="0" cellspacing="0" border="0">

<tr> <td class="title" align="left" colspan="3">Find service providers</td> </tr>

<form id="rpsearch" type="GET" action="javascript:return(true)">
<tr><td class="grouplabel" colspan="99">Search filter</td></tr>
<tr>
<td class="groupitem"><input type="checkbox" id="selectic" value="IC"  $checked  onClick="doFilter()" />InCommon service providers</td>
</tr>
<td class="groupitem"><input type="checkbox" id="selectuw" value="UW"  $checked  onClick="doFilter()" />UW locally registered providers</td>
</tr>
<td align="left" ${nowrap}><input type="text" width="40" id="selecttxt" value="" onKeyup="doFilter()"/>&nbsp;Match entity id text</td>
</tr>
<tr>
## <td><input class="chooserbutton" type="submit" name="select" value="Refresh"/></td>
</tr>
</form>

<tr><td height="20">

## this filled in by javascript
<tr><td id="splist" colspan="99">
</td></tr>

</table>

#pageMiddle

##
## ----- right side extra text ----
##
<p height="100px">&nbsp;</p>


<table class="helptext" cellpadding="4px">
<tr><th align="left" colspan="99">Service Providers</td></tr>
<tr><td width="10px"/><td valign="top" colspan="2">The list shows all the Service Providers
   known to the IdP, along with the federation each belongs to.
   </td></tr>

#foreach ($md in $metadata )
  #if ( $md.id != 'UWfixed' )
   <tr><td/><td>$md.id</td><td>${md.description}:&nbsp;</td></tr>
  #end
#end

<tr><td width="10px"/><td valign="top" colspan="2">Click on a Service Provider to
  see or edit its content.
   </td></tr>
<tr><td width="10px"/><td valign="top" colspan="2">Use the search window to select
  Service Providers by a simple substring match.
   </td></tr>
</table>


#pageEnd

## error and status messages
<div id="requestStatusDiv" class="notice">&nbsp;
</div>
<div class="status">${status}
</div>

