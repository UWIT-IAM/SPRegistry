#* ========================================================================
 * Copyright (c) 2009-2013 The University of Washington
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================================
 *#

##
## Templates for rp edit 
##

<script>
v_sectionType = 'rp';

v_xsrf = '${xsrf}';

var entityId;

// pseudo getbyname that works with ie
function getElementsByIdname(base) {
   var list = [];
   var i = 0;
   while (document.getElementById(base + '_' + i)) {
      list.push(document.getElementById(base + '_' + i++));
   }
   return list;
}

// show some inputs
function showMoreFields(name, id) {
   // show the first set of hidden ones
   for (e=0; e<20; e++) {
     var enam = name + e;
     list = getElementsByIdname(name+e);
     if (list.length==0) break;
     if (list[0].style.display == '') continue;
     for (i=0; i<list.length; i++) {
        list[i].style.display = '';
        list[i].className = 'messyDetail';
     }
     return;
   }
   plus = document.getElementById(id);
   plus.style.display = 'none';
}

// delete an rp
function deleteRP() {
   entityId = document.getElementById('entityid').value.trim();
   if (entityId=='') return;
   if (!confirm('Permanently delete the Service Provider: ' + entityId + '?')) return;

   finalAction = showDeletedGroup;
   doRequest('DELETE', '${root}${vers}/rp?id=' + entityId + '&mdid=UW&xsrf=${xsrf}', '', null);
}

function showDeletedGroup()
{
   page=document.getElementById('PageContent');
   page.innerHTML = '<p>Service provider ${relyingParty.entityId} deleted.</p>';
}


</script>


<div id="groupEditPane" dojoType="dijit.layout.ContentPane" doLayout="true" style="overflow:auto;display:none " >

  <div id="groupEditLinks" class="tabbox" dojoType="dijit.layout.ContentPane" doLayout="false">
  <ul>
  <li class="sublist" >Actions:</li>
  <li class="sublist" ><a href="javascript:handleGroupViewBtn()">View</a></li>
  </ul>
  </div>

<form id="rpForm" action="" method="POST">

<table class="iamtable">

      <tr><td class="grouplabel">Entity Id</td>
      <td align="left" colspan="3">
    #if ( ! $newEntity )
       <input type="hidden" id="entityid" value="${relyingParty.entityId}"/>${relyingParty.entityId}
    #else
       <input dojoType="dijit.form.TextBox" size="50" id="entityid" value="$!{relyingParty.entityId}"/>
    #end
      <td/></tr>


#if ( $metadataByLookup )
  <tr><td colspan="99">This metadata was generated by the Service Provider's Metadata response.</td></tr>
#end
#if ( $metadataByDefault )
  <tr><td colspan="99" class="warn">Your Service Provider did not respond to a request for metadata. 
These are default values for a Shibboleth 2.x Service Provider.  They will very likely need to be edited.</td></tr>
#end

    ## class codes borrowed from gws
    <tr><th colspan="3">General information</th></tr>

## Organization
   #set ( $count = 0 )

      #set ( $org = $relyingParty.organization )

   #if ( $org )
     <tr id="org0_0">
      <td class="label">Name:</td><td><input dojoType="dijit.form.TextBox" size="50" id="orgn_0" value="$!org.name" /></td>
     </tr>
     <tr id="org0_1">
      <td class="label">Display:</td><td><input dojoType="dijit.form.TextBox" size="50" id="orgd_0" value="$!org.displayName" /></td>
     </tr>
     <tr id="org0_2">
      <td class="label">Url:</td><td><input dojoType="dijit.form.TextBox" size="50" id="orgu_0" value="$!org.url" /></td>
     </tr>
     #set ( $count = $count + 1)
   #end

 
 ## Contacts
      <tr><td class="label">Contacts</td>
       <td><table>
   #set ( $count = 0 )
   #foreach ( $ct in $relyingParty.contactPersons )
     <tr id="ct${count}_0">
      <td class="label"  >Type:</td><td>
       <select id="ctt_${count}">
       #foreach ( $t in ["","technical","support","administrative","billing","other"] )
         <option value="$t" 
           #if ( $t == $ct.type )
             selected="selected"
           #end
         >$t</option>
       #end
       </select>
     </td>
     </tr>
     <tr id="ct${count}_1">
      <td class="label"  >Name:</td><td><input dojoType="dijit.form.TextBox" size="50" id="ctgn_${count}" value="$!ct.givenName" /></td>
     </tr>
     <tr id="ct${count}_2">
      <td class="label"  >Email:</td><td><input dojoType="dijit.form.TextBox" size="50" id="cte_${count}" value="$!ct.email" /></td>
     </tr>
     <tr id="ct${count}_3">
      <td class="label"  >Phone:</td><td><input dojoType="dijit.form.TextBox" size="50" id="ctp_${count}" value="$!ct.phone" /></td>
     </tr>
     <tr><td/><td colspan="99" height="5"></td></tr>
     #set ( $count = $count + 1)
   #end
 
   #foreach ( $i in [ $count .. 4 ] )
     <tr id="ct${i}_0" #if ( $i > 1 ) ${hide} #end >
      <td class="label"  >Type:</td><td>
       <select id="ctt_${i}">
       #foreach ( $t in ["","technical","support","administrative","billing","other"] )
         <option value="$t" 
           #if ( $t == "" )
             selected="selected"
           #end
         >$t</option>
       #end
       </select>
     </td>
     </tr>
     <tr id="ct${i}_1" #if ( $i > 1 ) ${hide} #end >
      <td class="label"  >Name:</td><td><input dojoType="dijit.form.TextBox" size="50" id="ctgn_${i}" value="" /></td>
     </tr>
     <tr id="ct${i}_2" #if ( $i > 1 ) ${hide} #end >
      <td class="label"  >Email:</td><td><input dojoType="dijit.form.TextBox" size="50" id="cte_${i}" value="" /></td>
     </tr>
     <tr id="ct${i}_3" #if ( $i > 1 ) ${hide} #end >
      <td class="label"  >Phone:</td><td><input dojoType="dijit.form.TextBox" size="50" id="ctp_${i}" value="" /></td>
     </tr>
     #set ( $label = "" )
   #end
   <tr id="ct_more"><td class="cleanlink" colspan="3"><a href="javascript:showMoreFields('ct', 'ct_more')">add contact person</a></td></tr>

   </table></td></tr>

  </table></td></tr>


## Details

     <tr><th colspan="3">Metadata details</th><th>
     <span id="rpeshowDetail"><a href="javascript:showDetail('rpe')">Show</a></span>
     <span id="rpehideDetail" ${hide} ><a href="javascript:hideDetail('rpe')">Hide</a></span>
     </th></tr>
  </table>

       <table class="iamtable">


 ## ProtocolSupportEnumerations

      <tr><td class="grouplabel">Protocols</td>
      </tr>
   #set ( $count = 0 )
   #foreach ( $ps in $relyingParty.protocolSupportEnumerations )
     <tr id="pse${count}_0">
      <td class="label"</td><td><input dojoType="dijit.form.TextBox" size="40" name="pse_data" id="pse_${count}" value="$ps" /></td>
     </tr>
     #set ( $count = $count + 1)
   #end

   #foreach ( $i in [ $count .. 4 ] )
     <tr id="pse${i}_0" ${hide}>
      <td class="label"></td><td><input dojoType="dijit.form.TextBox" size="40" name="pse" id="pse_${i}" value="" /></td>
     </tr>
   #end
   <tr id="pse_more"><td/><td class="cleanlink"><a href="javascript:showMoreFields('pse', 'pse_more')">+</a></td></tr>
 
   ## KeyInfo

      <tr><td class="grouplabel">KeyInfo</td>
      </tr>
   #set ( $count = 0 )
   #foreach ( $key in $relyingParty.keyDescriptors )
      <tr id="ki${count}_0">
      <td class="label" >Name:</td>
        <td><input dojoType="dijit.form.TextBox" size="40" name="keyName_${count}" id="kn_${count}" value="$!key.keyName" /></td>
      </tr>

      <tr id="ki${count}_1">
      <td class="label"  valign="top">Cert:</td>
         <td class="certbox"><textarea cols="64" rows="5" name="keyCert_${count}" id="kc_${count}">$!key.certificate</textarea></td>
      </tr>
     #set ( $count = $count + 1)
   #end

   #foreach ( $i in [ $count .. 3 ] )
   
      <tr id="ki${i}_0" ${hide}>
      <td class="label" >Name:</td>
        <td><input dojoType="dijit.form.TextBox" size="40" name="keyName_${i}" id="kn_${i}" value="" /></td>
      </tr>
      <tr id="ki${i}_1" ${hide}>
      <td class="label"  valign="top">Cert:</td>
         <td class="certbox"><textarea cols="64" rows="10" name="keyCert_${i}" id="kc_${i}"></textarea></td>
      </tr>

   #end
     <tr id="ki_more"><td/><td class="cleanlink"><a href="javascript:showMoreFields('ki', 'ki_more')">+</a></td></tr>

 
   ## Nameid

      <tr><td class="grouplabel">NameID</td>
      </tr>
   #set ( $count = 0 )
   #foreach ( $name in $relyingParty.nameIDFormats )
     <tr id="ni${count}_0">
      <td class="label"><td><input dojoType="dijit.form.TextBox" size="40" name="nameId_${count}" id="ni_${count}" value="$name" /></td>
     </tr>
     #set ( $count = $count + 1)
   #end

   #foreach ( $i in [ $count .. 4 ] )
     <tr id="ni${i}_0" ${hide}>
      <td class="label"><td><input dojoType="dijit.form.TextBox" size="40" name="nameId_${xtra}" id="ni_${i}" value="" /></td>
     </tr>
   #end
     <tr id="ni_more"><td/><td class="cleanlink"><a href="javascript:showMoreFields('ni', 'ni_more')">+</a></td></tr>
 
   ## ACS
      <tr><td class="grouplabel" colspan="99">ACS</td>
      </tr>
   #set ( $count = 0 )
   #foreach ( $acs in $relyingParty.assertionConsumerServices )
     <tr id="acs${count}_0">
      <td class="label" align="right" ><input dojoType="dijit.form.TextBox" size="2" id="acsi_${count}" value="$acs.index"/></td>
             <td nowrap="nowrap"><input dojoType="dijit.form.TextBox" size="50" id="acsb_${count}" value="$acs.binding" /></td>
     </tr>
     <tr id="acs${count}_1">
      <td class="label"  ></td>
             <td nowrap="nowrap"><input dojoType="dijit.form.TextBox" size="50" id="acsl_${count}" value="$acs.location" /></td>
     </tr>
     <tr><td></td><td colspan="99" height="3"></td></tr>
     #set ( $count = $count + 1)
   #end

   #foreach ( $i in [ $count .. 49 ] )
     <tr id="acs${i}_0" ${hide}>
      <td class="label" align="right" ><input dojoType="dijit.form.TextBox" size="2" id="acsi_${i}" value=""/></td>
             <td nowrap="nowrap"><input dojoType="dijit.form.TextBox" size="50" id="acsb_${i}" value="" /></td>
     </tr>
     <tr id="acs${i}_1" ${hide}><td></td>
             <td nowrap="nowrap"><input dojoType="dijit.form.TextBox" size="50" id="acsl_${i}" value="" /></td>
     </tr>
   #end
     <tr id="acs_more"><td/><td class="cleanlink"><a href="javascript:showMoreFields('acs', 'acs_more')">+</a></td></tr>

</table></td></tr>


   <tr><td/><td colspan="99"><hr></td></tr>

  </table>
 </form>


## submitter

#if ( $newEntity )
<span>Your submission will be processed automatically.  Please allow a 40 minutes for our IdP to acquire
your new service provider's metadata. 
</span>
#else
<span>Your submission will be processed automatically.  Please allow a 40 minutes for our IdP to acquire
your service provider's changed metadata. 
</span>
#end

<form id="submitter" action="#rp">
<input id="submitterButton" type="button" name="save" #if ( $newEntity ) value="Create" #else value="Save changes" #end onClick="saveRP()">
</form>

</div>

<div id="requestStatusDiv" class="notice" $hide>&nbsp;
</div>
<div class="status">$!{status}
</div>

